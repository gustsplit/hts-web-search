<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <title>US HTS Code Finder (PoC)</title>
  <style>
    :root {
      --primary: #3182f6;
      --primary-dark: #2563d9;
      --bg: #f5f7fb;
      --text-main: #111827;
      --text-sub: #6b7280;
      --border-soft: #d1d5db;
      --card-bg: #ffffff;
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      padding: 24px;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui,
        sans-serif;
      background: var(--bg);
      color: var(--text-main);
    }

    .app-shell {
      max-width: 960px;
      margin: 0 auto;
    }

    .card {
      background: var(--card-bg);
      border-radius: 18px;
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.06);
      padding: 24px 28px 28px;
      margin-bottom: 18px;
    }

    .app-header {
      margin-bottom: 18px;
    }

    .finder-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      gap: 12px;
    }

    .finder-title {
      flex: 1;
      min-width: 0;
    }

    .app-title-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 6px;
    }

    .logo-dot {
      width: 10px;
      height: 10px;
      border-radius: 999px;
      background: var(--primary);
    }

    h1 {
      font-size: 22px;
      font-weight: 700;
      margin: 0;
      letter-spacing: -0.02em;
    }

    .app-subtitle {
      font-size: 13px;
      color: var(--text-sub);
      margin: 0;
      line-height: 1.5;
    }

    .language-switcher {
      position: relative;
      align-self: flex-start;
    }

    .lang-button {
      padding: 9px 14px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: #ffffff;
      color: var(--text-main);
      font-weight: 700;
      font-size: 13px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.12);
      transition: background-color 0.15s ease, box-shadow 0.15s ease,
        transform 0.06s ease;
    }

    .lang-button:hover {
      background: #f9fafb;
      box-shadow: 0 12px 32px rgba(15, 23, 42, 0.14);
      transform: translateY(-1px);
    }

    .lang-button:active {
      transform: translateY(0);
      box-shadow: 0 8px 18px rgba(15, 23, 42, 0.12);
    }

    .lang-caret {
      font-size: 12px;
      color: #6b7280;
    }

    .lang-menu {
      position: absolute;
      top: calc(100% + 8px);
      right: 0;
      background: #ffffff;
      border: 1px solid #e5e7eb;
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.14);
      border-radius: 12px;
      padding: 8px;
      min-width: 200px;
      max-width: 240px;
      max-height: 280px;
      overflow-y: auto;
      display: none;
      z-index: 30;
    }

    .lang-menu.open {
      display: block;
    }

    .lang-option {
      width: 100%;
      text-align: left;
      border: none;
      background: transparent;
      border-radius: 4px;
      padding: 9px 11px;
      font-size: 13px;
      color: var(--text-main);
      cursor: pointer;
      transition: background-color 0.15s ease, box-shadow 0.15s ease,
        transform 0.06s ease, color 0.12s ease;
    }

    .lang-option:hover {
      background: #f5f7fb;
      box-shadow: 0 10px 20px rgba(15, 23, 42, 0.10);
      transform: translateY(-1px);
    }

    .lang-option.active {
      background: #eef3ff;
      color: #1d4ed8;
      font-weight: 700;
    }

    /* Form */

    form {
      display: grid;
      grid-template-columns: minmax(0, 1fr);
      gap: 14px;
      margin-top: 10px;
      margin-bottom: 22px;
    }

    .field-label {
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 4px;
      color: #111827;
    }

    input,
    textarea {
      width: 100%;
      padding: 9px 11px;
      border-radius: 10px;
      border: 1px solid var(--border-soft);
      font-size: 13px;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease,
        background-color 0.15s ease;
      background: #f9fafb;
    }

    input:focus,
    textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(49, 130, 246, 0.35);
      background: #ffffff;
    }

    textarea {
      resize: vertical;
      min-height: 70px;
      max-height: 200px;
      line-height: 1.4;
    }

    .form-row-inline {
      display: grid;
      grid-template-columns: 1.1fr 0.9fr;
      gap: 12px;
    }

    .button-row {
      margin-top: 4px;
    }

    button {
      padding: 9px 20px;
      border-radius: 999px;
      border: none;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      background: var(--primary);
      color: #ffffff;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      box-shadow: 0 10px 25px rgba(49, 130, 246, 0.35);
      transition: background-color 0.15s ease, box-shadow 0.15s ease,
        transform 0.05s ease;
    }

    button:hover {
      background: var(--primary-dark);
      box-shadow: 0 14px 30px rgba(37, 99, 217, 0.45);
      transform: translateY(-1px);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 8px 18px rgba(37, 99, 217, 0.38);
    }

    .btn-icon {
      font-size: 16px;
    }

    /* Results */

    .results-section-title {
      margin-top: 10px;
      margin-bottom: 6px;
      font-size: 15px;
      font-weight: 600;
    }

    #results {
      margin-top: 8px;
      font-size: 13px;
      color: var(--text-main);
    }

    .loading-text {
      font-size: 13px;
      color: var(--text-sub);
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 8px;
      border-radius: 14px;
      overflow: hidden;
      background: #f9fafb;
    }

    thead {
      background: #eef3ff;
    }

    th,
    td {
      border-bottom: 1px solid #e5e7eb;
      padding: 9px 10px;
      text-align: left;
      vertical-align: top;
    }

    th {
      font-size: 12px;
      font-weight: 600;
      color: #4b5563;
    }

    td {
      font-size: 13px;
      color: #111827;
    }

    tbody tr:last-child td {
      border-bottom: none;
    }

    tbody tr:nth-child(even) {
      background: #f3f4ff;
    }

    .error-box {
      background: #fff4f5;
      border: 1px solid #fecaca;
      border-radius: 12px;
      padding: 10px 12px;
      white-space: pre-wrap;
      color: #b91c1c;
      font-size: 12px;
    }

    .badge-pill {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      font-size: 11px;
      border-radius: 999px;
      background: #e5f0ff;
      color: #1d4ed8;
      margin-left: 4px;
    }

    /* Duty simulation card */

    .duty-card-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .duty-subtitle {
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 10px;
    }

    .duty-grid {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 12px;
      margin-bottom: 10px;
    }

    .duty-result {
      font-size: 14px;
      font-weight: 600;
      margin-top: 4px;
    }

    .badge-hts {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      font-size: 11px;
      border-radius: 999px;
      background: #ecfdf5;
      color: #047857;
      margin-left: 4px;
    }

    .muted {
      font-size: 12px;
      color: var(--text-sub);
      margin-top: 2px;
    }

    .hidden {
      display: none;
    }

    /* HTS íˆ´íŒ */
    .hts-tooltip {
      position: fixed;
      z-index: 9999;
      background: #111827;
      color: #f9fafb;
      padding: 10px 12px;
      border-radius: 10px;
      font-size: 11px;
      max-width: 320px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.4);
      pointer-events: none;
      opacity: 0;
      transform: translate(-50%, -8px);
      transition: opacity 0.08s ease;
      white-space: normal;
    }

    .hts-tooltip.visible {
      opacity: 0.97;
    }

    .hts-tooltip table {
      width: 100%;
      border-collapse: collapse;
    }

    .hts-tooltip th,
    .hts-tooltip td {
      padding: 2px 0;
      border: none;
      font-size: 11px;
    }

    .hts-tooltip th {
      color: #9ca3af;
      text-align: left;
    }

    .hts-tooltip td.code {
      font-weight: 600;
      padding-right: 8px;
      white-space: nowrap;
    }

    /* =========================
       ì´ë©”ì¼ Step / ë¯¸ë¦¬ë³´ê¸° ìŠ¤íƒ€ì¼
       ========================= */

    .email-card-title {
      font-size: 15px;
      font-weight: 600;
      margin-bottom: 6px;
    }

    .email-subtitle {
      font-size: 13px;
      color: var(--text-sub);
      margin-bottom: 12px;
    }

    .email-inline-row {
      display: grid;
      grid-template-columns: 1.3fr 0.7fr;
      gap: 10px;
      align-items: flex-end;
      margin-bottom: 10px;
    }

    .email-preview-box {
      margin-top: 12px;
      padding: 14px 16px;
      border-radius: 14px;
      background: #f9fafb;
      border: 1px solid #e5e7eb;
      font-size: 12px;
      color: #111827;
      white-space: pre-wrap;
      line-height: 1.5;
    }

    .email-preview-header {
      font-weight: 600;
      margin-bottom: 6px;
      font-size: 12px;
    }

    .email-preview-meta {
      font-size: 11px;
      color: #6b7280;
      margin-bottom: 6px;
    }

    .badge-step {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      font-size: 11px;
      border-radius: 999px;
      background: #eef3ff;
      color: #1d4ed8;
      margin-left: 4px;
    }

    @media (max-width: 640px) {
      .card {
        padding: 18px 16px 20px;
      }

      .form-row-inline {
        grid-template-columns: 1fr;
      }

      .duty-grid {
        grid-template-columns: 1fr;
      }

      .email-inline-row {
        grid-template-columns: 1fr;
      }

      th,
      td {
        font-size: 12px;
      }

      .finder-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }

      .language-switcher {
        align-self: flex-end;
      }

      .lang-menu {
        max-width: calc(100vw - 32px);
      }
    }
  </style>
</head>

<body>
  <div class="app-shell">
    <!-- ë©”ì¸ ê²€ìƒ‰ ì¹´ë“œ -->
    <div class="card">

      <header class="app-header">
        <div class="finder-header">
          <div class="finder-title">
            <div class="app-title-row">
              <div class="logo-dot"></div>
              <h1 data-i18n="title.main">US HTS Code Finder</h1>
            </div>
            <p class="app-subtitle" data-i18n="subtitle.main">
              ì…ë ¥í•˜ì‹  ìƒí’ˆ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¯¸êµ­ HTS í›„ë³´ ì½”ë“œë¥¼ ì¶”ì²œí•´ ë“œë ¤ìš”.
            </p>
          </div>

          <div class="language-switcher">
            <button id="lang-button" class="lang-button" type="button">
              ğŸŒ <span id="lang-button-label">í•œêµ­ì–´</span>
              <span class="lang-caret">â–¾</span>
            </button>
            <div id="lang-menu" class="lang-menu">
              <button class="lang-option" data-lang="auto" data-i18n="lang.auto">
                Automatic
              </button>
              <button class="lang-option" data-lang="en-US" data-i18n="lang.en">
                ì˜ì–´
              </button>
              <button class="lang-option" data-lang="ko-KR" data-i18n="lang.ko">
                í•œêµ­ì–´
              </button>
              <button class="lang-option" data-lang="zh-CN" data-i18n="lang.zh">
                ä¸­æ–‡
              </button>
              <button class="lang-option" data-lang="es-MX" data-i18n="lang.es">
                Espanol
              </button>
              <button class="lang-option" data-lang="ja-JP" data-i18n="lang.ja">
                æ—¥æœ¬èª
              </button>
            </div>
          </div>
        </div>
      </header>


      <form id="hts-form">
        <div>
          <div class="field-label" data-i18n="form.productNameLabel">ì œí’ˆëª… (Product Name)</div>
          <input type="text" id="product_name" placeholder="ì˜ˆ: ì˜¥ìˆ˜ìˆ˜" data-i18n-placeholder="form.productNamePlaceholder"
            required />
        </div>

        <div class="form-row-inline">
          <div>
            <div class="field-label" data-i18n="form.exporterHsLabel">ìˆ˜ì¶œì HS ì½”ë“œ (í•œêµ­, ì„ íƒ)</div>
            <input type="text" id="exporter_hs" placeholder="ì˜ˆ: 1005.90"
              data-i18n-placeholder="form.exporterHsPlaceholder" />
          </div>
          <div>
            <div class="field-label" data-i18n="form.countryLabel">ì›ì‚°ì§€ (Country of Origin)</div>
            <input type="text" id="country_of_origin" placeholder="ì˜ˆ: Korea"
              data-i18n-placeholder="form.countryPlaceholder" required />
          </div>
        </div>

        <div>
          <div class="field-label" data-i18n="form.descriptionLabel">ì œí’ˆ ì„¤ëª… (Product Description)</div>
          <textarea id="description" rows="4" placeholder="ì˜ˆ: ì¡°ë¦¬í•˜ì§€ ì•Šì€ ë‚ ê²ƒì˜ ì‹ìš© ì˜¥ìˆ˜ìˆ˜"
            data-i18n-placeholder="form.descriptionPlaceholder" required></textarea>
        </div>

        <div class="button-row">
          <button type="submit">
            <span class="btn-icon">ğŸ”</span>
            <span data-i18n="form.submitButton">HTS ì½”ë“œ ê²€ìƒ‰í•˜ê¸°</span>
          </button>
        </div>
      </form>

      <div class="results-section-title">
        <span data-i18n="step1.title">Step 1 â€” HTS ì½”ë“œ</span>
        <span class="badge-pill" data-i18n="results.badge">LLM ê¸°ë°˜ í›„ë³´ ë¦¬ìŠ¤íŠ¸</span>
      </div>
      <div id="results"></div>
    </div>



    <!-- Duty simulation card -->

    <div class="card hidden" id="duty-section">

      <div class="duty-card-title" data-i18n="step2.title">Step 2 â€” ê´€ì„¸</div>

      <div class="duty-subtitle" data-i18n="duty.subtitle">

        ìœ„ì—ì„œ ì„ íƒí•˜ì‹  HTS ì½”ë“œ ê¸°ì¤€ìœ¼ë¡œ, ìˆ˜ëŸ‰ê³¼ ë‹¨ê°€(USD)ë¥¼ ì…ë ¥í•´ ì˜ˆìƒ ê´€ì„¸ë¥¼ ê°„ë‹¨íˆ ê³„ì‚°í•´ ë³´ì„¸ìš”.

      </div>



      <div class="muted" id="fx-info" data-i18n="duty.fxLoading">

        í™˜ìœ¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...

      </div>

      <div class="muted" id="selected-hts-info" data-i18n="duty.selectPrompt">

        ì•„ì§ HTS ì½”ë“œë¥¼ ì„ íƒí•˜ì§€ ì•Šìœ¼ì…¨ì–´ìš”. í‘œì—ì„œ í•˜ë‚˜ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.

      </div>



      <div class="duty-grid">

        <div>

          <div class="field-label" data-i18n="duty.qty">ìˆ˜ëŸ‰</div>

          <input type="number" id="qty" min="1" placeholder="ì˜ˆ: 100" data-i18n-placeholder="duty.qtyPlaceholder" />

        </div>

        <div>

          <div class="field-label" data-i18n="duty.unitPrice">ë‹¨ê°€ (USD $)</div>

          <input type="number" id="unit_price" min="0" step="0.01" placeholder="ì˜ˆ: 50"
            data-i18n-placeholder="duty.unitPricePlaceholder" />

        </div>

        <div style="display:flex; align-items:flex-end;">

          <button type="button" id="calc-duty-btn">

            <span class="btn-icon">ğŸ“Š</span>

            <span data-i18n="duty.calcButton">ê´€ì„¸ ê³„ì‚°í•˜ê¸°</span>

          </button>

        </div>

      </div>



      <div class="duty-result" id="duty-result"></div>

      <div class="muted" data-i18n="duty.note">

        * ì‹¤ì œ ê´€ì„¸ëŠ” ì„¸ê´€ ì‹ ê³  ë‚´ìš©, FTA, ì¶”ê°€ ì„¸ìœ¨ ë“±ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë©°, ì´ ê³„ì‚°ì€ ì°¸ê³ ìš© ì‹œë®¬ë ˆì´ì…˜ì…ë‹ˆë‹¤.

      </div>

    </div>



    <!-- ì´ë©”ì¼ Step ì¹´ë“œ (ìƒˆë¡œìš´ Step) -->

    <div class="card hidden" id="email-section">

      <div class="email-card-title">
        <span data-i18n="step3.title">Step 3 â€” ì´ë©”ì¼</span>
        <span class="badge-step" data-i18n="email.stepBadge">Step 3 Â· Email</span>
      </div>
      <div class="email-subtitle" data-i18n="email.subtitle">

        ì§€ê¸ˆê¹Œì§€ ì…ë ¥í•˜ì‹  ìƒí’ˆ ì •ë³´, ì„ íƒí•˜ì‹  HTS ì½”ë“œ, ê·¸ë¦¬ê³  ë°©ê¸ˆ ê³„ì‚°í•œ ê´€ì„¸ ê¸ˆì•¡ì„ í•œ ë²ˆì— ì •ë¦¬í•´ì„œ

        ë©”ì¼ ì´ˆì•ˆìœ¼ë¡œ ë§Œë“¤ì–´ ë“œë ¤ìš”.

      </div>



      <div class="email-inline-row">

        <div>

          <div class="field-label" data-i18n="email.emailLabel">ì´ë©”ì¼ ì£¼ì†Œ</div>

          <input type="email" id="email_to" placeholder="ì˜ˆ: name@example.com"
            data-i18n-placeholder="email.emailPlaceholder" />

        </div>

        <div>

          <div class="field-label" data-i18n="email.tokenLabel">API Access Token</div>

          <input type="password" id="email_access_token" placeholder="X-Access-Token í—¤ë” ê°’"
            data-i18n-placeholder="email.tokenPlaceholder" autocomplete="off" />

        </div>

        <div>

          <button type="button" id="email-preview-btn">

            <span class="btn-icon">âœ‰ï¸</span>

            <span data-i18n="email.previewButton">ì´ë©”ì¼ ë¯¸ë¦¬ë³´ê¸° ë§Œë“¤ê¸°</span>

          </button>

        </div>

      </div>



      <div class="muted" data-i18n="email.note">

        * ì‹¤ì œ ë°œì†¡ ì „ì—, ì•„ë˜ì„œ ë©”ì¼ ë‚´ìš©ì„ ë¨¼ì € í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆì–´ìš”.

      </div>



      <div id="email-preview" class="email-preview-box hidden">

        <!-- JSì—ì„œ ë‚´ìš© ì±„ì›€ -->

      </div>



      <div style="margin-top:10px;">

        <button type="button" id="email-send-btn" class="hidden">

          <span class="btn-icon">âœ…</span>

          <span data-i18n="email.sendButton">ì´ ë‚´ìš©ìœ¼ë¡œ ì´ë©”ì¼ ë³´ë‚´ê¸°</span>

        </button>

        <div id="email-send-status" class="muted hidden"></div>

      </div>

    </div>





    <!-- ë©´ì±… ê³ ì§€ë¬¸ -->

    <div style="font-size:11px; color:#888; margin-top:30px; text-align:center;" data-i18n="footer.disclaimer">

      * ë³¸ ì„œë¹„ìŠ¤ì˜ HTS ì½”ë“œ ë° ê´€ì„¸ìœ¨ì€ ì°¸ê³ ìš©ìœ¼ë¡œ ì œê³µë˜ë©°, ì‹¤ì œ ì„¸ìœ¨ ë° ë¶„ë¥˜ëŠ” ë¯¸êµ­ CBP ë° ê´€ì„¸ë‹¹êµ­ì˜ ìµœì¢… ê²°ì •ì— ë”°ë¦…ë‹ˆë‹¤. ë³¸ ì •ë³´ì— ê¸°ë°˜í•œ ëª¨ë“  íŒë‹¨ ë° ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.

    </div>

    <!-- HTS ì½”ë“œ êµ¬ì¡° íˆ´íŒ -->
    <div id="hts-tooltip" class="hts-tooltip"></div>

    <script>
      const form = document.getElementById("hts-form");
      const resultsEl = document.getElementById("results");
      const dutySection = document.getElementById("duty-section");
      const selectedInfoEl = document.getElementById("selected-hts-info");
      const dutyResultEl = document.getElementById("duty-result");
      const fxInfoEl = document.getElementById("fx-info");
      const calcBtn = document.getElementById("calc-duty-btn");
      const qtyInput = document.getElementById("qty");
      const unitPriceInput = document.getElementById("unit_price");
      const htsTooltip = document.getElementById("hts-tooltip");

      const emailSection = document.getElementById("email-section");
      const emailToInput = document.getElementById("email_to");
      const emailAccessTokenInput = document.getElementById("email_access_token");
      const emailPreviewBtn = document.getElementById("email-preview-btn");
      const emailPreviewEl = document.getElementById("email-preview");
      const emailSendBtn = document.getElementById("email-send-btn");
      const emailSendStatusEl = document.getElementById("email-send-status");
      const langButton = document.getElementById("lang-button");
      const langButtonLabel = document.getElementById("lang-button-label");
      const langMenu = document.getElementById("lang-menu");
      const langOptions = document.querySelectorAll(".lang-option");

      // ë§ˆì§€ë§‰ í›„ë³´ë“¤ ì €ì¥ (ë¼ë””ì˜¤ ì„ íƒ ì‹œ ì°¸ì¡°)
      let lastCandidates = [];
      // ì„ íƒëœ í›„ë³´ index
      let lastSelectedIndex = -1;
      // ê´€ì„¸ ê³„ì‚° ê²°ê³¼ ì €ì¥
      let lastDutyCalc = null;
      // USD-KRW í™˜ìœ¨
      let usdKrwRate = null;
      // HTS ì„¤ëª… ìºì‹œ
      const htsExplainCache = {};
      // ë§ˆì§€ë§‰ ì´ë©”ì¼ ì´ˆì•ˆ ì €ì¥ (ë°œì†¡ ì‹œ ì‚¬ìš©)
      let lastEmailDraft = null;

      // ì´ë©”ì¼ í† í° ë¡œë“œ (ìˆìœ¼ë©´ ìë™ ì…ë ¥)
      const savedAccessToken = localStorage.getItem("EMAIL_ACCESS_TOKEN");
      if (savedAccessToken) {
        emailAccessTokenInput.value = savedAccessToken;
      }

      const LANG_LABELS = {
        auto: "Automatic",
        "en-US": "English",
        "ko-KR": "í•œêµ­ì–´",
        "zh-CN": "ä¸­æ–‡",
        "es-MX": "Espanol",
        "ja-JP": "æ—¥æœ¬èª",
      };


      const I18N = {
        "en-US": {
          "step1.title": "Step 1 â€” HTS Code",
          "step2.title": "Step 2 â€” Duty",
          "step3.title": "Step 3 â€” Email",
          "lang.auto": "Automatic",
          "lang.en": "English",
          "lang.ko": "Korean",
          "lang.zh": "Chinese",
          "lang.es": "Spanish",
          "lang.ja": "Japanese",
          "title.main": "US HTS Code Finder",
          "subtitle.main": "We recommend likely US HTS codes based on your product details.",
          "form.productNameLabel": "Product Name",
          "form.productNamePlaceholder": "e.g., corn",
          "form.exporterHsLabel": "Exporter HS Code (Korea, optional)",
          "form.exporterHsPlaceholder": "e.g., 1005.90",
          "form.countryLabel": "Country of Origin",
          "form.countryPlaceholder": "e.g., Korea",
          "form.descriptionLabel": "Product Description",
          "form.descriptionPlaceholder": "e.g., raw edible corn, not cooked",
          "form.submitButton": "Search HTS Code",
          "results.sectionTitle": "HTS Code Suggestions",
          "results.badge": "LLM Candidate List",
          "results.loading": "Analyzing HTS candidates with LLM...",
          "results.noCandidates": "No HTS codes to recommend.",
          "results.table.select": "Select",
          "results.table.confidence": "Confidence",
          "results.table.code": "US HTS Code",
          "results.table.title": "Item Name",
          "results.table.tariff": "Duty Rate",
          "results.table.reason": "Classification Notes",
          "duty.title": "Wondering how much duty youâ€™ll pay?",
          "duty.subtitle": "Using the HTS code you selected above, enter quantity and unit price (USD) to estimate duty.",
          "duty.fxLoading": "Loading FX info...",
          "duty.fxError": "Could not fetch FX info. (KRW view may be unavailable.)",
          "duty.fxInfo": "Current rate: 1 USD â‰ˆ {rate} KRW{timestamp}",
          "duty.selectPrompt": "Select an HTS code in the table above first.",
          "duty.qty": "Quantity",
          "duty.qtyPlaceholder": "e.g., 100",
          "duty.unitPrice": "Unit Price (USD $)",
          "duty.unitPricePlaceholder": "e.g., 50",
          "duty.calcButton": "Calculate Duty",
          "duty.note": "* Actual duty may vary by declaration, FTA, or additional rates. This is a reference simulation.",
          "duty.alertSelect": "Please select an HTS code in the table first.",
          "duty.alertInputs": "Enter valid quantity and unit price (USD).",
          "duty.selectedInfo": "Selected HTS: <strong>{code}</strong><span class=\"badge-hts\">Duty: {rate}</span>",
          "duty.resultEquation": "Estimated customs value <strong>{totalValueUsd} USD</strong> Ã— duty rate <strong>{ratePct}</strong> = <strong>{dutyUsd} USD</strong>",
          "duty.resultKrw": "<br />KRW view: value <strong>{totalKrw} KRW</strong> / duty <strong>{dutyKrw} KRW</strong> (FX {fxRate} KRW/USD)",
          "duty.resultNoFx": "<br />* FX unavailable; KRW view is hidden.",
          "email.title": "Get the HTS code and duty calculation by email?",
          "email.stepBadge": "Step 3 Â· Email",
          "email.subtitle": "Weâ€™ll compile your product details, chosen HTS code, and the duty estimate into an email draft.",
          "email.emailLabel": "Email address",
          "email.emailPlaceholder": "e.g., name@example.com",
          "email.tokenLabel": "API Access Token",
          "email.tokenPlaceholder": "X-Access-Token header value",
          "email.previewButton": "Create email preview",
          "email.note": "* Before sending, review the email content below.",
          "email.previewTitle": "Email Preview",
          "email.previewLoading": "Preparing the email content...",
          "email.sendButton": "Send email with this content",
          "email.statusSending": "Sending email...",
          "email.statusSuccess": "Email sent. Please check your inbox.",
          "email.statusError": "Email send error: {error}",
          "alerts.needSelection": "Select an HTS code and finish the duty calculation first.",
          "alerts.needDuty": "Please complete the duty calculation first.",
          "alerts.emailRequired": "Enter an email address.",
          "alerts.emailFormat": "Please check the email address format.",
          "alerts.needPreview": "Generate the email preview first.",
          "footer.disclaimer": "* HTS codes and duty rates here are for reference only. Final rates/classifications are determined by US CBP and customs authorities. All decisions and responsibility based on this info rest with the user.",
          "tooltip.title": "Code Structure / Classification",
          "tooltip.colCode": "Code",
          "tooltip.colMeaning": "Meaning",
          "tooltip.loading": "Loading code structure...",
          "tooltip.noData": "Could not load code structure info.",
        },
        "ko-KR": {
          "step1.title": "Step 1 â€” HTS ì½”ë“œ",
          "step2.title": "Step 2 â€” ê´€ì„¸",
          "step3.title": "Step 3 â€” ì´ë©”ì¼",
          "lang.auto": "Automatic",
          "lang.en": "ì˜ì–´",
          "lang.ko": "í•œêµ­ì–´",
          "lang.zh": "ì¤‘êµ­ì–´",
          "lang.es": "ìŠ¤í˜ì¸ì–´",
          "lang.ja": "ì¼ë³¸ì–´",
          "title.main": "US HTS Code Finder",
          "subtitle.main": "ì…ë ¥í•˜ì‹  ìƒí’ˆ ì •ë³´ë¥¼ ê¸°ë°˜ìœ¼ë¡œ ë¯¸êµ­ HTS í›„ë³´ ì½”ë“œë¥¼ ì¶”ì²œí•´ ë“œë ¤ìš”.",
          "form.productNameLabel": "ì œí’ˆëª… (Product Name)",
          "form.productNamePlaceholder": "ì˜ˆ: ì˜¥ìˆ˜ìˆ˜",
          "form.exporterHsLabel": "ìˆ˜ì¶œì HS ì½”ë“œ (í•œêµ­, ì„ íƒ)",
          "form.exporterHsPlaceholder": "ì˜ˆ: 1005.90",
          "form.countryLabel": "ì›ì‚°ì§€ (Country of Origin)",
          "form.countryPlaceholder": "ì˜ˆ: Korea",
          "form.descriptionLabel": "ì œí’ˆ ì„¤ëª… (Product Description)",
          "form.descriptionPlaceholder": "ì˜ˆ: ì¡°ë¦¬í•˜ì§€ ì•Šì€ ë‚ ê²ƒì˜ ì‹ìš© ì˜¥ìˆ˜ìˆ˜",
          "form.submitButton": "HTS ì½”ë“œ ê²€ìƒ‰í•˜ê¸°",
          "results.sectionTitle": "HTS ì½”ë“œ ì¶”ì²œ ê²°ê³¼",
          "results.badge": "LLM ê¸°ë°˜ í›„ë³´ ë¦¬ìŠ¤íŠ¸",
          "results.loading": "LLMì´ HTS í›„ë³´ë¥¼ ë¶„ì„í•˜ëŠ” ì¤‘ì…ë‹ˆë‹¤...",
          "results.noCandidates": "ì¶”ì²œí•  HTS ì½”ë“œê°€ ì—†ìŠµë‹ˆë‹¤.",
          "results.table.select": "ì„ íƒ",
          "results.table.confidence": "ì‹ ë¢°ë„",
          "results.table.code": "US HTS Code",
          "results.table.title": "í’ˆëª©ëª…",
          "results.table.tariff": "ê´€ì„¸ìœ¨",
          "results.table.reason": "ë¶„ë¥˜ ì„¤ëª…",
          "duty.title": "ì‹¤ì œ ì–¼ë§ˆë‚˜ ê´€ì„¸ê°€ ë‚˜ì˜¬ì§€ ê¶ê¸ˆí•˜ì‹ ê°€ìš”?",
          "duty.subtitle": "ìœ„ì—ì„œ ì„ íƒí•˜ì‹  HTS ì½”ë“œ ê¸°ì¤€ìœ¼ë¡œ, ìˆ˜ëŸ‰ê³¼ ë‹¨ê°€(USD)ë¥¼ ì…ë ¥í•´ ì˜ˆìƒ ê´€ì„¸ë¥¼ ê°„ë‹¨íˆ ê³„ì‚°í•´ ë³´ì„¸ìš”.",
          "duty.fxLoading": "í™˜ìœ¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...",
          "duty.fxError": "í™˜ìœ¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤. (ì›í™” ê³„ì‚°ì´ ì¼ì‹œì ìœ¼ë¡œ í‘œì‹œë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.)",
          "duty.fxInfo": "í˜„ì¬ ì ìš© í™˜ìœ¨: 1 USD â‰ˆ {rate} KRW{timestamp}",
          "duty.selectPrompt": "ì•„ì§ HTS ì½”ë“œë¥¼ ì„ íƒí•˜ì§€ ì•Šìœ¼ì…¨ì–´ìš”. í‘œì—ì„œ í•˜ë‚˜ë¥¼ ì„ íƒí•´ ì£¼ì„¸ìš”.",
          "duty.qty": "ìˆ˜ëŸ‰",
          "duty.qtyPlaceholder": "ì˜ˆ: 100",
          "duty.unitPrice": "ë‹¨ê°€ (USD $)",
          "duty.unitPricePlaceholder": "ì˜ˆ: 50",
          "duty.calcButton": "ê´€ì„¸ ê³„ì‚°í•˜ê¸°",
          "duty.note": "* ì‹¤ì œ ê´€ì„¸ëŠ” ì„¸ê´€ ì‹ ê³  ë‚´ìš©, FTA, ì¶”ê°€ ì„¸ìœ¨ ë“±ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë©°, ì´ ê³„ì‚°ì€ ì°¸ê³ ìš© ì‹œë®¬ë ˆì´ì…˜ì…ë‹ˆë‹¤.",
          "duty.alertSelect": "ë¨¼ì € í‘œì—ì„œ HTS ì½”ë“œë¥¼ í•˜ë‚˜ ì„ íƒí•´ ì£¼ì„¸ìš”.",
          "duty.alertInputs": "ìˆ˜ëŸ‰ê³¼ ë‹¨ê°€(USD)ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•´ ì£¼ì„¸ìš”.",
          "duty.selectedInfo": "ì„ íƒí•œ HTS: <strong>{code}</strong><span class=\"badge-hts\">ê´€ì„¸ìœ¨: {rate}</span>",
          "duty.resultEquation": "ì˜ˆìƒ ê³¼ì„¸ê°€ê²© <strong>{totalValueUsd} USD</strong> Ã— ê´€ì„¸ìœ¨ <strong>{ratePct}</strong> = <strong>{dutyUsd} USD</strong>",
          "duty.resultKrw": "<br />ì˜ˆìƒ ê³¼ì„¸ê°€ê²© <strong>{totalKrw} KRW</strong> / ì˜ˆìƒ ê´€ì„¸ <strong>{dutyKrw} KRW</strong> (í™˜ìœ¨ {fxRate} KRW/USD ê¸°ì¤€)",
          "duty.resultNoFx": "<br />* í™˜ìœ¨ ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í•´ ì›í™” ê³„ì‚°ì„ í‘œì‹œí•˜ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.",
          "email.title": "US HTS ì½”ë“œì™€ ê´€ì„¸ ê³„ì‚° ë‚´ìš©ì„ ì´ë©”ì¼ë¡œ ë°›ì•„ë³´ì‹œê² ì–´ìš”?",
          "email.stepBadge": "Step 3 Â· Email",
          "email.subtitle": "ì§€ê¸ˆê¹Œì§€ ì…ë ¥í•˜ì‹  ìƒí’ˆ ì •ë³´, ì„ íƒí•˜ì‹  HTS ì½”ë“œ, ê·¸ë¦¬ê³  ë°©ê¸ˆ ê³„ì‚°í•œ ê´€ì„¸ ê¸ˆì•¡ì„ í•œ ë²ˆì— ì •ë¦¬í•´ì„œ ë©”ì¼ ì´ˆì•ˆìœ¼ë¡œ ë§Œë“¤ì–´ ë“œë ¤ìš”.",
          "email.emailLabel": "ì´ë©”ì¼ ì£¼ì†Œ",
          "email.emailPlaceholder": "ì˜ˆ: name@example.com",
          "email.tokenLabel": "API Access Token",
          "email.tokenPlaceholder": "X-Access-Token í—¤ë” ê°’",
          "email.previewButton": "ì´ë©”ì¼ ë¯¸ë¦¬ë³´ê¸° ë§Œë“¤ê¸°",
          "email.note": "* ì‹¤ì œ ë°œì†¡ ì „ì—, ì•„ë˜ì„œ ë©”ì¼ ë‚´ìš©ì„ ë¨¼ì € í™•ì¸í•˜ì‹¤ ìˆ˜ ìˆì–´ìš”.",
          "email.previewTitle": "ì´ë©”ì¼ ë¯¸ë¦¬ë³´ê¸°",
          "email.previewLoading": "ì´ë©”ì¼ ë‚´ìš©ì„ ì¤€ë¹„í•˜ê³  ìˆì–´ìš”...",
          "email.sendButton": "ì´ ë‚´ìš©ìœ¼ë¡œ ì´ë©”ì¼ ë³´ë‚´ê¸°",
          "email.statusSending": "ì´ë©”ì¼ì„ ë³´ë‚´ëŠ” ì¤‘ì…ë‹ˆë‹¤...",
          "email.statusSuccess": "ì´ë©”ì¼ì„ ë°œì†¡í–ˆì–´ìš”. ë°›ì€ í¸ì§€í•¨ì„ í™•ì¸í•´ ì£¼ì„¸ìš”.",
          "email.statusError": "ì´ë©”ì¼ ë°œì†¡ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: {error}",
          "alerts.needSelection": "ë¨¼ì € HTS ì½”ë“œë¥¼ ì„ íƒí•˜ê³  ê´€ì„¸ ê³„ì‚°ê¹Œì§€ ì™„ë£Œí•´ ì£¼ì„¸ìš”.",
          "alerts.needDuty": "ê´€ì„¸ ê³„ì‚°ì„ ë¨¼ì € ì™„ë£Œí•´ ì£¼ì„¸ìš”.",
          "alerts.emailRequired": "ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ ì£¼ì„¸ìš”.",
          "alerts.emailFormat": "ì´ë©”ì¼ ì£¼ì†Œ í˜•ì‹ì„ ë‹¤ì‹œ í™•ì¸í•´ ì£¼ì„¸ìš”.",
          "alerts.needPreview": "ë¨¼ì € ì´ë©”ì¼ ë¯¸ë¦¬ë³´ê¸°ë¥¼ ìƒì„±í•´ ì£¼ì„¸ìš”.",
          "footer.disclaimer": "* ë³¸ ì„œë¹„ìŠ¤ì˜ HTS ì½”ë“œ ë° ê´€ì„¸ìœ¨ì€ ì°¸ê³ ìš©ìœ¼ë¡œ ì œê³µë˜ë©°, ì‹¤ì œ ì„¸ìœ¨ ë° ë¶„ë¥˜ëŠ” ë¯¸êµ­ CBP ë° ê´€ì„¸ë‹¹êµ­ì˜ ìµœì¢… ê²°ì •ì— ë”°ë¦…ë‹ˆë‹¤. ë³¸ ì •ë³´ì— ê¸°ë°˜í•œ ëª¨ë“  íŒë‹¨ ë° ì±…ì„ì€ ì‚¬ìš©ìì—ê²Œ ìˆìŠµë‹ˆë‹¤.",
          "tooltip.title": "ì½”ë“œ êµ¬ì¡° / ë¶„ë¥˜ ì²´ê³„",
          "tooltip.colCode": "ì½”ë“œ êµ¬ì¡°",
          "tooltip.colMeaning": "ì˜ë¯¸",
          "tooltip.loading": "ì½”ë“œ êµ¬ì¡°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...",
          "tooltip.noData": "ì½”ë“œ êµ¬ì¡° ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.",
        },
        "zh-CN": {
          "step1.title": "Step 1 â€” HTSç¼–ç ",
          "step2.title": "Step 2 â€” å…³ç¨",
          "step3.title": "Step 3 â€” é‚®ä»¶",
          "lang.auto": "Automatic",
          "lang.en": "English",
          "lang.ko": "éŸ©è¯­",
          "lang.zh": "ä¸­æ–‡",
          "lang.es": "Espanol",
          "lang.ja": "æ—¥è¯­",
          "title.main": "ç¾å›½ HTS ä»£ç æŸ¥æ‰¾å™¨",
          "subtitle.main": "æ ¹æ®æ‚¨è¾“å…¥çš„å•†å“ä¿¡æ¯ï¼Œæ¨èå¯èƒ½çš„ç¾å›½ HTS ä»£ç ã€‚",
          "form.productNameLabel": "å•†å“å (Product Name)",
          "form.productNamePlaceholder": "ä¾‹ï¼šç‰ç±³",
          "form.exporterHsLabel": "å‡ºå£å•† HS ä»£ç ï¼ˆéŸ©å›½ï¼Œå¯é€‰ï¼‰",
          "form.exporterHsPlaceholder": "ä¾‹ï¼š1005.90",
          "form.countryLabel": "åŸäº§å›½ (Country of Origin)",
          "form.countryPlaceholder": "ä¾‹ï¼šKorea",
          "form.descriptionLabel": "å•†å“æè¿° (Product Description)",
          "form.descriptionPlaceholder": "ä¾‹ï¼šæœªç»åŠ å·¥çš„é£Ÿç”¨ç‰ç±³",
          "form.submitButton": "æœç´¢ HTS ä»£ç ",
          "results.sectionTitle": "HTS ä»£ç æ¨èç»“æœ",
          "results.badge": "LLM å€™é€‰åˆ—è¡¨",
          "results.loading": "LLM æ­£åœ¨åˆ†æ HTS å€™é€‰...",
          "results.noCandidates": "æ²¡æœ‰å¯æ¨èçš„ HTS ä»£ç ã€‚",
          "results.table.select": "é€‰æ‹©",
          "results.table.confidence": "ç½®ä¿¡åº¦",
          "results.table.code": "US HTS Code",
          "results.table.title": "å“ç›®å",
          "results.table.tariff": "å…³ç¨ç‡",
          "results.table.reason": "åˆ†ç±»è¯´æ˜",
          "duty.title": "æƒ³çŸ¥é“å¤§æ¦‚è¦äº¤å¤šå°‘å…³ç¨å—ï¼Ÿ",
          "duty.subtitle": "åŸºäºä¸Šé¢é€‰æ‹©çš„ HTS ä»£ç ï¼Œè¾“å…¥æ•°é‡å’Œå•ä»·(USD)ï¼Œå¿«é€Ÿä¼°ç®—å…³ç¨ã€‚",
          "duty.fxLoading": "æ­£åœ¨è·å–æ±‡ç‡ä¿¡æ¯...",
          "duty.fxError": "æœªèƒ½è·å–æ±‡ç‡ä¿¡æ¯ã€‚ï¼ˆæš‚æ—¶æ— æ³•æ˜¾ç¤ºæœ¬å¸é‡‘é¢ï¼‰",
          "duty.fxInfo": "å½“å‰æ±‡ç‡ï¼š1 USD â‰ˆ {rate} KRW{timestamp}",
          "duty.selectPrompt": "è¿˜æ²¡æœ‰é€‰æ‹© HTS ä»£ç ï¼Œè¯·åœ¨è¡¨æ ¼ä¸­é€‰æ‹©ä¸€é¡¹ã€‚",
          "duty.qty": "æ•°é‡",
          "duty.qtyPlaceholder": "ä¾‹ï¼š100",
          "duty.unitPrice": "å•ä»· (USD $)",
          "duty.unitPricePlaceholder": "ä¾‹ï¼š50",
          "duty.calcButton": "è®¡ç®—å…³ç¨",
          "duty.note": "* å®é™…å…³ç¨å¯èƒ½å› æŠ¥å…³å†…å®¹ã€FTA æˆ–é™„åŠ ç¨ç‡ç­‰ä¸åŒï¼Œæ­¤è®¡ç®—ä»…ä¾›å‚è€ƒã€‚",
          "duty.alertSelect": "è¯·å…ˆåœ¨ä¸Šæ–¹ç»“æœä¸­é€‰æ‹©ä¸€ä¸ª HTS ä»£ç ã€‚",
          "duty.alertInputs": "è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°é‡å’Œå•ä»·(USD)ã€‚",
          "duty.selectedInfo": "å·²é€‰ HTS: <strong>{code}</strong><span class=\"badge-hts\">å…³ç¨ç‡: {rate}</span>",
          "duty.resultEquation": "é¢„ä¼°è´§å€¼ <strong>{totalValueUsd} USD</strong> Ã— å…³ç¨ç‡ <strong>{ratePct}</strong> = <strong>{dutyUsd} USD</strong>",
          "duty.resultKrw": "<br />é¢„ä¼°éŸ©å…ƒé‡‘é¢ï¼šè´§å€¼ <strong>{totalKrw} KRW</strong> / å…³ç¨ <strong>{dutyKrw} KRW</strong>ï¼ˆæ±‡ç‡ {fxRate} KRW/USDï¼‰",
          "duty.resultNoFx": "<br />* æœªèƒ½è·å–æ±‡ç‡ï¼Œæš‚ä¸æ˜¾ç¤ºéŸ©å…ƒé‡‘é¢ã€‚",
          "email.title": "æƒ³æŠŠ US HTS ä»£ç å’Œå…³ç¨è®¡ç®—ç»“æœé€šè¿‡é‚®ä»¶æ¥æ”¶å—ï¼Ÿ",
          "email.stepBadge": "Step 3 Â· Email",
          "email.subtitle": "å°†å•†å“ä¿¡æ¯ã€é€‰æ‹©çš„ HTS ä»£ç å’Œå…³ç¨è®¡ç®—ç»“æœæ•´ç†æˆé‚®ä»¶è‰ç¨¿å‘é€ç»™æ‚¨ã€‚",
          "email.emailLabel": "é‚®ç®±åœ°å€",
          "email.emailPlaceholder": "ä¾‹ï¼šname@example.com",
          "email.tokenLabel": "API Access Token",
          "email.tokenPlaceholder": "X-Access-Token å¤´éƒ¨å€¼",
          "email.previewButton": "ç”Ÿæˆé‚®ä»¶é¢„è§ˆ",
          "email.note": "* å‘é€å‰ï¼Œå¯åœ¨ä¸‹æ–¹å…ˆç¡®è®¤é‚®ä»¶å†…å®¹ã€‚",
          "email.previewTitle": "é‚®ä»¶é¢„è§ˆ",
          "email.previewLoading": "æ­£åœ¨å‡†å¤‡é‚®ä»¶å†…å®¹...",
          "email.sendButton": "ç”¨æ­¤å†…å®¹å‘é€é‚®ä»¶",
          "email.statusSending": "æ­£åœ¨å‘é€é‚®ä»¶...",
          "email.statusSuccess": "é‚®ä»¶å·²å‘é€ï¼Œè¯·æ£€æŸ¥æ”¶ä»¶ç®±ã€‚",
          "email.statusError": "å‘é€é‚®ä»¶æ—¶å‡ºé”™ï¼š{error}",
          "alerts.needSelection": "è¯·é€‰æ‹© HTS ä»£ç å¹¶å®Œæˆå…³ç¨è®¡ç®—ã€‚",
          "alerts.needDuty": "è¯·å…ˆå®Œæˆå…³ç¨è®¡ç®—ã€‚",
          "alerts.emailRequired": "è¯·è¾“å…¥é‚®ç®±åœ°å€ã€‚",
          "alerts.emailFormat": "è¯·æ£€æŸ¥é‚®ç®±åœ°å€æ ¼å¼ã€‚",
          "alerts.needPreview": "è¯·å…ˆç”Ÿæˆé‚®ä»¶é¢„è§ˆã€‚",
          "footer.disclaimer": "* æœ¬æœåŠ¡æä¾›çš„ HTS ä»£ç ä¸å…³ç¨ç‡ä»…ä¾›å‚è€ƒï¼Œå®é™…ç¨ç‡ä¸åˆ†ç±»ä»¥ç¾å›½ CBP åŠå…³åŠ¡æœºå…³çš„æœ€ç»ˆå†³å®šä¸ºå‡†ã€‚åŸºäºæœ¬ä¿¡æ¯çš„æ‰€æœ‰åˆ¤æ–­ä¸è´£ä»»ç”±ç”¨æˆ·è‡ªè¡Œæ‰¿æ‹…ã€‚",
          "tooltip.title": "ä»£ç ç»“æ„ / åˆ†ç±»ä½“ç³»",
          "tooltip.colCode": "ä»£ç ç»“æ„",
          "tooltip.colMeaning": "å«ä¹‰",
          "tooltip.loading": "æ­£åœ¨è·å–ä»£ç ç»“æ„...",
          "tooltip.noData": "æœªèƒ½è·å–ä»£ç ç»“æ„ä¿¡æ¯ã€‚",
        },
        "es-MX": {
          "step1.title": "Step 1 â€” CÃ³digo HTS",
          "step2.title": "Step 2 â€” Arancel",
          "step3.title": "Step 3 â€” Correo",
          "lang.auto": "Automatic",
          "lang.en": "English",
          "lang.ko": "Coreano",
          "lang.zh": "Chino",
          "lang.es": "Espanol",
          "lang.ja": "Japones",
          "title.main": "Buscador de Codigos HTS de EE. UU.",
          "subtitle.main": "Recomendamos codigos HTS de EE. UU. segun la informacion de tu producto.",
          "form.productNameLabel": "Nombre del producto (Product Name)",
          "form.productNamePlaceholder": "Ej.: maiz",
          "form.exporterHsLabel": "Codigo HS del exportador (Corea, opcional)",
          "form.exporterHsPlaceholder": "Ej.: 1005.90",
          "form.countryLabel": "Pais de origen (Country of Origin)",
          "form.countryPlaceholder": "Ej.: Korea",
          "form.descriptionLabel": "Descripcion del producto (Product Description)",
          "form.descriptionPlaceholder": "Ej.: maiz para consumo, sin cocinar",
          "form.submitButton": "Buscar codigo HTS",
          "results.sectionTitle": "Resultados de codigos HTS sugeridos",
          "results.badge": "Lista de candidatos LLM",
          "results.loading": "Analizando candidatos HTS con LLM...",
          "results.noCandidates": "No hay codigos HTS para recomendar.",
          "results.table.select": "Elegir",
          "results.table.confidence": "Confianza",
          "results.table.code": "US HTS Code",
          "results.table.title": "Nombre del producto",
          "results.table.tariff": "Tasa arancelaria",
          "results.table.reason": "Descripcion de la clasificacion",
          "duty.title": "Â¿Quieres saber cuanto podrias pagar de arancel?",
          "duty.subtitle": "Con el codigo HTS elegido arriba, ingresa cantidad y precio unitario (USD) para estimar el arancel.",
          "duty.fxLoading": "Cargando tipo de cambio...",
          "duty.fxError": "No pudimos obtener el tipo de cambio. (No se mostrara el monto en moneda local.)",
          "duty.fxInfo": "Tipo de cambio: 1 USD â‰ˆ {rate} KRW{timestamp}",
          "duty.selectPrompt": "Aun no has elegido un codigo HTS. Selecciona uno en la tabla.",
          "duty.qty": "Cantidad",
          "duty.qtyPlaceholder": "Ej.: 100",
          "duty.unitPrice": "Precio unitario (USD $)",
          "duty.unitPricePlaceholder": "Ej.: 50",
          "duty.calcButton": "Calcular arancel",
          "duty.note": "* El arancel real puede variar segun la declaracion, FTA o tasas adicionales. Este calculo es solo de referencia.",
          "duty.alertSelect": "Primero elige un codigo HTS en los resultados.",
          "duty.alertInputs": "Ingresa cantidad y precio unitario (USD) validos.",
          "duty.selectedInfo": "HTS elegido: <strong>{code}</strong><span class=\"badge-hts\">Tasa: {rate}</span>",
          "duty.resultEquation": "Valor imponible <strong>{totalValueUsd} USD</strong> Ã— tasa <strong>{ratePct}</strong> = <strong>{dutyUsd} USD</strong>",
          "duty.resultKrw": "<br />En KRW: valor <strong>{totalKrw} KRW</strong> / arancel <strong>{dutyKrw} KRW</strong> (tipo {fxRate} KRW/USD)",
          "duty.resultNoFx": "<br />* No se pudo obtener el tipo de cambio; no se muestra en KRW.",
          "email.title": "Â¿Quieres recibir por correo el codigo HTS y el calculo del arancel?",
          "email.stepBadge": "Step 3 Â· Email",
          "email.subtitle": "Reunimos la info del producto, el codigo HTS elegido y el calculo del arancel en un borrador de correo.",
          "email.emailLabel": "Correo electronico",
          "email.emailPlaceholder": "Ej.: name@example.com",
          "email.tokenLabel": "API Access Token",
          "email.tokenPlaceholder": "Valor del encabezado X-Access-Token",
          "email.previewButton": "Crear vista previa del correo",
          "email.note": "* Antes de enviar, revisa el contenido del correo aquÃ­.",
          "email.previewTitle": "Vista previa del correo",
          "email.previewLoading": "Preparando el contenido del correo...",
          "email.sendButton": "Enviar correo con este contenido",
          "email.statusSending": "Enviando el correo...",
          "email.statusSuccess": "Correo enviado. Revisa tu bandeja de entrada.",
          "email.statusError": "Error al enviar el correo: {error}",
          "alerts.needSelection": "Elige un codigo HTS y completa el calculo del arancel primero.",
          "alerts.needDuty": "Primero completa el calculo del arancel.",
          "alerts.emailRequired": "Ingresa una direccion de correo.",
          "alerts.emailFormat": "Revisa el formato del correo electronico.",
          "alerts.needPreview": "Primero genera la vista previa del correo.",
          "footer.disclaimer": "* Los codigos HTS y tasas mostrados son de referencia. Las tasas y clasificaciones finales dependen del CBP de EE. UU. y autoridades aduaneras. Todas las decisiones basadas en esta informacion son responsabilidad del usuario.",
          "tooltip.title": "Estructura del codigo / Clasificacion",
          "tooltip.colCode": "Estructura",
          "tooltip.colMeaning": "Significado",
          "tooltip.loading": "Cargando estructura del codigo...",
          "tooltip.noData": "No pudimos obtener la estructura del codigo.",
        },
        "ja-JP": {
          "step1.title": "Step 1 â€” HTSã‚³ãƒ¼ãƒ‰",
          "step2.title": "Step 2 â€” é–¢ç¨",
          "step3.title": "Step 3 â€” ãƒ¡ãƒ¼ãƒ«",
          "lang.auto": "Automatic",
          "lang.en": "English",
          "lang.ko": "éŸ“å›½èª",
          "lang.zh": "ä¸­å›½èª",
          "lang.es": "ã‚¹ãƒšã‚¤ãƒ³èª",
          "lang.ja": "æ—¥æœ¬èª",
          "title.main": "US HTS ã‚³ãƒ¼ãƒ‰æ¤œç´¢",
          "subtitle.main": "å…¥åŠ›ã—ãŸå•†å“æƒ…å ±ã‚’ã‚‚ã¨ã«ã€ç±³å›½ HTS å€™è£œã‚³ãƒ¼ãƒ‰ã‚’ãŠã™ã™ã‚ã—ã¾ã™ã€‚",
          "form.productNameLabel": "å•†å“å (Product Name)",
          "form.productNamePlaceholder": "ä¾‹: ãƒˆã‚¦ãƒ¢ãƒ­ã‚³ã‚·",
          "form.exporterHsLabel": "è¼¸å‡ºè€… HS ã‚³ãƒ¼ãƒ‰ï¼ˆéŸ“å›½ã€ä»»æ„ï¼‰",
          "form.exporterHsPlaceholder": "ä¾‹: 1005.90",
          "form.countryLabel": "åŸç”£å›½ (Country of Origin)",
          "form.countryPlaceholder": "ä¾‹: Korea",
          "form.descriptionLabel": "å•†å“èª¬æ˜ (Product Description)",
          "form.descriptionPlaceholder": "ä¾‹: èª¿ç†ã—ã¦ã„ãªã„é£Ÿç”¨ãƒˆã‚¦ãƒ¢ãƒ­ã‚³ã‚·",
          "form.submitButton": "HTS ã‚³ãƒ¼ãƒ‰ã‚’æ¤œç´¢",
          "results.sectionTitle": "HTS ã‚³ãƒ¼ãƒ‰ã®æ¨è–¦çµæœ",
          "results.badge": "LLM å€™è£œãƒªã‚¹ãƒˆ",
          "results.loading": "LLM ãŒ HTS å€™è£œã‚’è§£æä¸­...",
          "results.noCandidates": "æ¨è–¦ã§ãã‚‹ HTS ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“ã€‚",
          "results.table.select": "é¸æŠ",
          "results.table.confidence": "ä¿¡é ¼åº¦",
          "results.table.code": "US HTS Code",
          "results.table.title": "å“ç›®å",
          "results.table.tariff": "é–¢ç¨ç‡",
          "results.table.reason": "åˆ†é¡ã®èª¬æ˜",
          "duty.title": "ã©ã‚Œãã‚‰ã„é–¢ç¨ãŒã‹ã‹ã‚‹ã‹æ°—ã«ãªã‚Šã¾ã™ã‹ï¼Ÿ",
          "duty.subtitle": "ä¸Šã§é¸ã‚“ã  HTS ã‚³ãƒ¼ãƒ‰ã‚’ã‚‚ã¨ã«ã€æ•°é‡ã¨å˜ä¾¡(USD)ã‚’å…¥åŠ›ã—ã¦é–¢ç¨ã‚’ç°¡å˜ã«è©¦ç®—ã§ãã¾ã™ã€‚",
          "duty.fxLoading": "ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—ã—ã¦ã„ã¾ã™...",
          "duty.fxError": "ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚ï¼ˆç¾åœ°é€šè²¨è¡¨ç¤ºã¯ä¸€æ™‚åœæ­¢ï¼‰",
          "duty.fxInfo": "ç¾åœ¨ã®ãƒ¬ãƒ¼ãƒˆ: 1 USD â‰ˆ {rate} KRW{timestamp}",
          "duty.selectPrompt": "ã¾ã  HTS ã‚³ãƒ¼ãƒ‰ã‚’é¸æŠã—ã¦ã„ã¾ã›ã‚“ã€‚è¡¨ã‹ã‚‰1ã¤é¸ã‚“ã§ãã ã•ã„ã€‚",
          "duty.qty": "æ•°é‡",
          "duty.qtyPlaceholder": "ä¾‹: 100",
          "duty.unitPrice": "å˜ä¾¡ (USD $)",
          "duty.unitPricePlaceholder": "ä¾‹: 50",
          "duty.calcButton": "é–¢ç¨ã‚’è¨ˆç®—",
          "duty.note": "* å®Ÿéš›ã®é–¢ç¨ã¯ç”³å‘Šå†…å®¹ã€FTAã€è¿½åŠ ç¨ç‡ãªã©ã§å¤‰ã‚ã‚Šã¾ã™ã€‚ã“ã‚Œã¯å‚è€ƒç”¨ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ã™ã€‚",
          "duty.alertSelect": "ã¾ãšçµæœè¡¨ã‹ã‚‰ HTS ã‚³ãƒ¼ãƒ‰ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚",
          "duty.alertInputs": "æ•°é‡ã¨å˜ä¾¡(USD)ã‚’æ­£ã—ãå…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",
          "duty.selectedInfo": "é¸æŠã—ãŸ HTS: <strong>{code}</strong><span class=\"badge-hts\">é–¢ç¨ç‡: {rate}</span>",
          "duty.resultEquation": "èª²ç¨ä¾¡æ ¼ <strong>{totalValueUsd} USD</strong> Ã— é–¢ç¨ç‡ <strong>{ratePct}</strong> = <strong>{dutyUsd} USD</strong>",
          "duty.resultKrw": "<br />KRWæ›ç®—: èª²ç¨ä¾¡æ ¼ <strong>{totalKrw} KRW</strong> / é–¢ç¨ <strong>{dutyKrw} KRW</strong>ï¼ˆãƒ¬ãƒ¼ãƒˆ {fxRate} KRW/USDï¼‰",
          "duty.resultNoFx": "<br />* ç‚ºæ›¿ãƒ¬ãƒ¼ãƒˆã‚’å–å¾—ã§ããšã€KRWè¡¨ç¤ºã‚’çœç•¥ã—ã¾ã—ãŸã€‚",
          "email.title": "US HTS ã‚³ãƒ¼ãƒ‰ã¨é–¢ç¨è¨ˆç®—ã‚’ãƒ¡ãƒ¼ãƒ«ã§å—ã‘å–ã‚Šã¾ã™ã‹ï¼Ÿ",
          "email.stepBadge": "Step 3 Â· Email",
          "email.subtitle": "å•†å“æƒ…å ±ãƒ»é¸æŠã—ãŸ HTS ã‚³ãƒ¼ãƒ‰ãƒ»è¨ˆç®—ã—ãŸé–¢ç¨é¡ã‚’ã¾ã¨ã‚ã¦ã€ãƒ¡ãƒ¼ãƒ«ä¸‹æ›¸ãã‚’ä½œæˆã—ã¾ã™ã€‚",
          "email.emailLabel": "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹",
          "email.emailPlaceholder": "ä¾‹: name@example.com",
          "email.tokenLabel": "API Access Token",
          "email.tokenPlaceholder": "X-Access-Token ãƒ˜ãƒƒãƒ€ãƒ¼å€¤",
          "email.previewButton": "ãƒ¡ãƒ¼ãƒ«ã®ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆ",
          "email.note": "* é€ä¿¡å‰ã«ã€ä¸‹ã§ãƒ¡ãƒ¼ãƒ«å†…å®¹ã‚’ç¢ºèªã§ãã¾ã™ã€‚",
          "email.previewTitle": "ãƒ¡ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼",
          "email.previewLoading": "ãƒ¡ãƒ¼ãƒ«å†…å®¹ã‚’æº–å‚™ã—ã¦ã„ã¾ã™...",
          "email.sendButton": "ã“ã®å†…å®¹ã§ãƒ¡ãƒ¼ãƒ«é€ä¿¡",
          "email.statusSending": "ãƒ¡ãƒ¼ãƒ«é€ä¿¡ä¸­ã§ã™...",
          "email.statusSuccess": "ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã€‚å—ä¿¡ç®±ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
          "email.statusError": "ãƒ¡ãƒ¼ãƒ«é€ä¿¡ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: {error}",
          "alerts.needSelection": "HTS ã‚³ãƒ¼ãƒ‰ã‚’é¸ã³ã€é–¢ç¨è¨ˆç®—ã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚",
          "alerts.needDuty": "å…ˆã«é–¢ç¨è¨ˆç®—ã‚’å®Œäº†ã—ã¦ãã ã•ã„ã€‚",
          "alerts.emailRequired": "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚",
          "alerts.emailFormat": "ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚",
          "alerts.needPreview": "å…ˆã«ãƒ¡ãƒ¼ãƒ«ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚",
          "footer.disclaimer": "* æœ¬ã‚µãƒ¼ãƒ“ã‚¹ã® HTS ã‚³ãƒ¼ãƒ‰ã¨ç¨ç‡ã¯å‚è€ƒæƒ…å ±ã§ã™ã€‚å®Ÿéš›ã®ç¨ç‡ãƒ»åˆ†é¡ã¯ç±³å›½ CBP ãªã©å½“å±€ã®æœ€çµ‚æ±ºå®šã«å¾“ã„ã¾ã™ã€‚æœ¬æƒ…å ±ã«åŸºã¥ãåˆ¤æ–­ãƒ»è²¬ä»»ã¯åˆ©ç”¨è€…ã«ã‚ã‚Šã¾ã™ã€‚",
          "tooltip.title": "ã‚³ãƒ¼ãƒ‰æ§‹é€  / åˆ†é¡ä½“ç³»",
          "tooltip.colCode": "ã‚³ãƒ¼ãƒ‰æ§‹é€ ",
          "tooltip.colMeaning": "æ„å‘³",
          "tooltip.loading": "ã‚³ãƒ¼ãƒ‰æ§‹é€ ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...",
          "tooltip.noData": "ã‚³ãƒ¼ãƒ‰æ§‹é€ æƒ…å ±ã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸã€‚",
        },
      };
      function t(key, replacements = {}) {
        const dict = I18N[currentLang] || I18N["ko-KR"];
        let value = dict[key] || I18N["ko-KR"][key] || key;
        Object.keys(replacements).forEach((k) => {
          value = value.replace(new RegExp(`{${k}}`, "g"), replacements[k]);
        });
        return value;
      }

      function applyTranslations() {
        document.querySelectorAll("[data-i18n]").forEach((el) => {
          const key = el.getAttribute("data-i18n");
          const value = t(key);
          if (el.classList.contains("badge-step")) {
            el.textContent = value;
          } else {
            el.textContent = value;
          }
        });

        document.querySelectorAll("[data-i18n-placeholder]").forEach((el) => {
          const key = el.getAttribute("data-i18n-placeholder");
          const value = t(key);
          el.setAttribute("placeholder", value);
        });
      }

      function resolveLanguage(langCode) {
        if (!langCode || langCode === "auto") {
          const nav = (navigator.language || navigator.userLanguage || "").toLowerCase();
          if (nav.startsWith("en")) return "en-US";
          if (nav.startsWith("ko")) return "ko-KR";
          if (nav.startsWith("zh")) return "zh-CN";
          if (nav.startsWith("es")) return "es-MX";
          if (nav.startsWith("ja")) return "ja-JP";
          return "ko-KR";
        }
        if (langCode.startsWith("en")) return "en-US";
        if (langCode.startsWith("ko")) return "ko-KR";
        if (langCode.startsWith("zh")) return "zh-CN";
        if (langCode.startsWith("es")) return "es-MX";
        if (langCode.startsWith("ja")) return "ja-JP";
        return "ko-KR";
      }

      function updateLangButtonLabel(value) {
        if (langButtonLabel) {
          langButtonLabel.textContent = LANG_LABELS[value] || value;
        }
        langOptions.forEach((opt) => {
          opt.classList.toggle("active", opt.getAttribute("data-lang") === value);
        });
      }

      let selectedLangPreference = localStorage.getItem("hts_finder_lang") || "auto";
      let currentLang = resolveLanguage(selectedLangPreference);

      function setLanguage(langCode, { persist = true } = {}) {
        selectedLangPreference = langCode;
        currentLang = resolveLanguage(langCode);
        if (persist) {
          localStorage.setItem("hts_finder_lang", langCode);
        }
        updateLangButtonLabel(langCode === "auto" ? "auto" : currentLang);
        applyTranslations();
        if (typeof window.changeLanguage === "function") {
          window.changeLanguage(currentLang);
        } else if (typeof window.handleLanguageChange === "function") {
          window.handleLanguageChange(currentLang);
        }
      }

      function closeLangMenu() {
        if (langMenu) {
          langMenu.classList.remove("open");
        }
        if (langButton) {
          langButton.setAttribute("aria-expanded", "false");
        }
      }

      function toggleLangMenu() {
        if (!langMenu || !langButton) return;
        const willOpen = !langMenu.classList.contains("open");
        langMenu.classList.toggle("open");
        langButton.setAttribute("aria-expanded", willOpen ? "true" : "false");
      }

      setLanguage(selectedLangPreference, { persist: false });

      if (langButton && langMenu) {
        langButton.addEventListener("click", (e) => {
          e.stopPropagation();
          toggleLangMenu();
        });

        langOptions.forEach((opt) => {
          opt.addEventListener("click", (e) => {
            e.stopPropagation();
            const langCode = opt.getAttribute("data-lang");
            setLanguage(langCode);
            closeLangMenu();
          });
        });

        document.addEventListener("click", (e) => {
          if (!langMenu.contains(e.target) && !langButton.contains(e.target)) {
            closeLangMenu();
          }
        });
      }
      function formatNumber(n) {
        if (isNaN(n)) return "";
        return n.toLocaleString(undefined, { maximumFractionDigits: 2 });
      }

      // "0%", "4.5%" ê°™ì€ ë¬¸ìì—´ì—ì„œ ìˆ«ìë§Œ ì¶”ì¶œí•´ì„œ ë¹„ìœ¨(0.0~1.0)ë¡œ ë³€í™˜
      function parseRate(rateStr) {
        if (!rateStr) return 0;
        const m = String(rateStr).match(/[\d.]+/);
        if (!m) return 0;
        const v = parseFloat(m[0]);
        if (isNaN(v)) return 0;
        return v / 100.0;
      }

      // ë°±ì—”ë“œì—ì„œ USD-KRW í™˜ìœ¨ ê°€ì ¸ì˜¤ê¸°


      async function fetchFxRate() {

        try {

          const res = await fetch("http://127.0.0.1:8000/api/exchange-rate/usd-krw");

          const data = await res.json();

          if (data.rate) {

            usdKrwRate = data.rate;

            const ts = data.timestamp ? ` (${new Date(data.timestamp).toLocaleString()})` : "";

            fxInfoEl.textContent = t("duty.fxInfo", {

              rate: usdKrwRate.toFixed(2),

              timestamp: ts,

            });

          } else {

            usdKrwRate = null;

            const ts = data.timestamp ? ` (${new Date(data.timestamp).toLocaleString()})` : "";

            fxInfoEl.textContent = t("duty.fxError", { timestamp: ts });

          }

        } catch (err) {

          console.error(err);

          usdKrwRate = null;

          fxInfoEl.textContent = t("duty.fxError");

        }

      }

      // í˜ì´ì§€ ë¡œë”© ì‹œ í™˜ìœ¨ ë¨¼ì € ê°€ì ¸ì˜¤ê¸°
      fetchFxRate();

      form.addEventListener("submit", async (e) => {
        e.preventDefault();
        resultsEl.innerHTML = `<span class="loading-text">${t("results.loading")}</span>`;
        dutyResultEl.textContent = "";
        selectedInfoEl.textContent = t("duty.selectPrompt");
        emailSection.classList.add("hidden");
        emailPreviewEl.classList.add("hidden");
        emailPreviewEl.innerHTML = "";
        emailSendBtn.classList.add("hidden");
        emailSendStatusEl.classList.add("hidden");
        emailSendStatusEl.textContent = "";
        lastSelectedIndex = -1;
        lastDutyCalc = null;
        lastEmailDraft = null;
        lastQueryPrompt = "";

        const payload = {
          product_name: document.getElementById("product_name").value,
          exporter_hs: document.getElementById("exporter_hs").value || null,
          description: document.getElementById("description").value,
          country_of_origin: document.getElementById("country_of_origin").value,
        };

        try {
          const res = await fetch("http://127.0.0.1:8000/api/search_hts", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });

          const data = await res.json();
          lastQueryPrompt = data.query_prompt || "";

          if (data.error) {
            resultsEl.innerHTML =
              '<div class="error-box">Error: ' +
              data.error +
              (data.raw ? "\n\nRaw:\n" + data.raw : "") +
              "</div>";
            dutySection.classList.add("hidden");
            return;
          }

          const candidates = data.items || data.candidates || [];
          lastCandidates = candidates;

          // í›„ë³´ title/reason í•œêµ­ì–´ ë²ˆì—­
          await translateCandidatesToKorean(lastCandidates);

          if (candidates.length === 0) {
            resultsEl.innerHTML = `<span class="loading-text">${t("results.noCandidates")}</span>`;
            dutySection.classList.add("hidden");
            return;
          }

          // í…Œì´ë¸” ìƒì„±
          let tableHtml = `
          <table>
            <thead>
              <tr>
                <th>${t("results.table.select")}</th>
                <th>${t("results.table.confidence")}</th>
                <th>${t("results.table.code")}</th>
                <th>${t("results.table.title")}</th>
                <th>${t("results.table.tariff")}</th>
                <th>${t("results.table.reason")}</th>
              </tr>
            </thead>
            <tbody>
        `;

          candidates.forEach((c, idx) => {
            const confText =
              c.confidence !== undefined && c.confidence !== null
                ? `${(Number(c.confidence) * 100).toFixed(0)}%`
                : "";
            tableHtml += `
            <tr>
              <td>
                <input type="radio" name="hts_choice" value="${idx}" />
              </td>
              <td>${confText}</td>
              <td class="hts-code-cell" data-hts="${c.hts_code || ""}">
                ${c.hts_code || ""}
              </td>
              <td>${c.title
                ? `<a class="hts-link" href="https://hts.usitc.gov/search?query=%22${encodeURIComponent(
                  c.hts_code || ""
                )}%22" target="_blank" rel="noopener noreferrer" onclick="event.stopPropagation();">${c.title}</a>`
                : ""
              }</td>
              <td>${c.tariff ?? c.estimated_tariff_rate ?? ""}</td>
              <td>${c.reason || ""}</td>
            </tr>
          `;
          });

          tableHtml += "</tbody></table>";
          resultsEl.innerHTML = tableHtml;

          // ê´€ì„¸ ì‹œë®¬ë ˆì´ì…˜ UI ë³´ì´ê¸° + ì‚´ì§ ìŠ¤í¬ë¡¤
          dutySection.classList.remove("hidden");
          setTimeout(() => {
            dutySection.scrollIntoView({ behavior: "smooth", block: "start" });
          }, 150);

          // ë¼ë””ì˜¤ ë²„íŠ¼ change í•¸ë“¤ëŸ¬ ë“±ë¡
          document.getElementsByName("hts_choice").forEach((radio) => {
            radio.addEventListener("change", () => {
              const idx = parseInt(radio.value, 10);
              const item = lastCandidates[idx];
              if (!item) return;
              lastSelectedIndex = idx;
              const rateStr = item.estimated_tariff_rate || item.tariff || "N/A";
              selectedInfoEl.innerHTML = t("duty.selectedInfo", {
                code: item.hts_code || "",
                rate: rateStr,
              });
              dutyResultEl.textContent = "";
              lastDutyCalc = null;
              emailSection.classList.add("hidden");
              emailPreviewEl.classList.add("hidden");
              emailPreviewEl.innerHTML = "";
              emailSendBtn.classList.add("hidden");
              emailSendStatusEl.classList.add("hidden");
              emailSendStatusEl.textContent = "";
              lastEmailDraft = null;
            });
          });

          // HTS ì½”ë“œ ì…€ í˜¸ë²„ í•¸ë“¤ëŸ¬ ì—°ê²°
          attachHTSHoverHandlers();
        } catch (err) {
          console.error(err);
          resultsEl.innerHTML =
            '<div class="error-box">Error: ' + String(err) + "</div>";
          dutySection.classList.add("hidden");
        }
      });

      function buildTooltipHtml(segments) {
        if (!segments || !segments.length) {
          return t("tooltip.noData");
        }

        let html = `
        <div style="margin-bottom:4px; font-weight:600; font-size:11px;">
          ${t("tooltip.title")}
        </div>
        <table>
          <thead>
            <tr>
              <th style="width:90px;">${t("tooltip.colCode")}</th>
              <th>${("tooltip.colMeaning")}</th>
            </tr>
          </thead>
          <tbody>
      `;

        segments.forEach(seg => {
          html += `
          <tr>
            <td class="code">${seg.code_part || ""}</td>
            <td>${seg.meaning_ko || ""}</td>
          </tr>
        `;
        });

        html += "</tbody></table>";
        return html;
      }

      async function fetchHTSExplain(htsCode) {
        if (!htsCode) return null;

        if (htsExplainCache[htsCode]) {
          return htsExplainCache[htsCode];
        }

        try {
          const res = await fetch("http://127.0.0.1:8000/api/explain_hts", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ hts_code: htsCode })
          });
          const data = await res.json();
          if (data.error) {
            console.error("explain_hts error:", data.error);
            return null;
          }
          htsExplainCache[htsCode] = data.segments || [];
          return htsExplainCache[htsCode];
        } catch (err) {
          console.error(err);
          return null;
        }
      }

      function attachHTSHoverHandlers() {
        const cells = document.querySelectorAll(".hts-code-cell");

        cells.forEach(cell => {
          const htsCode = cell.getAttribute("data-hts");

          cell.addEventListener("mouseenter", async (e) => {
            if (!htsCode) return;

            htsTooltip.innerHTML = t("tooltip.loading");
            htsTooltip.classList.add("visible");
            positionTooltip(e);

            const segments = await fetchHTSExplain(htsCode);
            htsTooltip.innerHTML = buildTooltipHtml(segments);
          });

          cell.addEventListener("mousemove", (e) => {
            positionTooltip(e);
          });

          cell.addEventListener("mouseleave", () => {
            htsTooltip.classList.remove("visible");
          });
        });
      }

      function positionTooltip(e) {
        const offsetX = 0;
        const offsetY = -12;
        htsTooltip.style.left = `${e.clientX + offsetX}px`;
        htsTooltip.style.top = `${e.clientY + offsetY}px`;
      }

      async function translateCandidatesToKorean(candidates) {
        if (!candidates || candidates.length === 0) return;

        for (const c of candidates) {
          const textToTranslate = `Title: ${c.title || ""}\nReason: ${c.reason || ""}`;

          try {
            const res = await fetch("http://127.0.0.1:8000/api/translate", {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({ text: textToTranslate }),
            });

            const data = await res.json();
            if (data.translated_text) {
              const lines = data.translated_text
                .split("\n")
                .map((l) => l.trim())
                .filter((l) => l.length > 0);

              const titleLine = lines.find((l) =>
                l.toLowerCase().startsWith("title:")
              );
              const reasonLine = lines.find((l) =>
                l.toLowerCase().startsWith("reason:")
              );

              if (titleLine) {
                c.title = titleLine.replace(/^title:\s*/i, "");
              }
              if (reasonLine) {
                c.reason = reasonLine.replace(/^reason:\s*/i, "");
              }
            }
          } catch (err) {
            console.error("Translation error:", err);
          }
        }
      }

      calcBtn.addEventListener("click", () => {
        const radios = document.getElementsByName("hts_choice");
        let selectedIndex = -1;
        radios.forEach((r) => {
          if (r.checked) selectedIndex = parseInt(r.value, 10);
        });

        if (selectedIndex < 0) {
          dutyResultEl.innerHTML = '<div class="error-box" style="margin-top:10px;">' + t("duty.alertSelect") + '</div>'; resultsEl.scrollIntoView({ behavior: "smooth", block: "center" });
          return;
        }

        const qty = parseFloat(qtyInput.value);
        const unitPrice = parseFloat(unitPriceInput.value);

        if (!qty || qty <= 0 || !unitPrice || unitPrice < 0) {
          alert(t("duty.alertInputs"));
          return;
        }

        const item = lastCandidates[selectedIndex];
        const rate = parseRate(item.estimated_tariff_rate || item.tariff);
        const totalValueUsd = qty * unitPrice;
        const dutyUsd = totalValueUsd * rate;

        const ratePct =
          item.estimated_tariff_rate ||
          item.tariff ||
          (rate ? (rate * 100).toFixed(2) + "%" : "N/A");

        let resultText = t("duty.resultEquation", {
          totalValueUsd: formatNumber(totalValueUsd),
          ratePct,
          dutyUsd: formatNumber(dutyUsd),
        });

        let totalKrw = null;
        let dutyKrw = null;

        if (usdKrwRate) {
          totalKrw = totalValueUsd * usdKrwRate;
          dutyKrw = dutyUsd * usdKrwRate;
          resultText += t("duty.resultKrw", {
            totalKrw: formatNumber(totalKrw),
            dutyKrw: formatNumber(dutyKrw),
            fxRate: usdKrwRate.toFixed(2),
          });
        } else {
          resultText += t("duty.resultNoFx");
        }

        dutyResultEl.innerHTML = resultText;

        // ìƒíƒœ ì €ì¥ (ì´í›„ ì´ë©”ì¼ Stepì—ì„œ ì‚¬ìš©)
        lastSelectedIndex = selectedIndex;
        lastDutyCalc = {
          qty,
          unitPrice,
          totalValueUsd,
          dutyUsd,
          ratePct,
          totalKrw,
          dutyKrw,
          usdKrwRate,
        };

        // ê´€ì„¸ ê³„ì‚°ì´ ëë‚˜ë©´ ì´ë©”ì¼ Step ì¹´ë“œ ë…¸ì¶œ + ìŠ¤í¬ë¡¤ ë‹¤ìš´
        emailSection.classList.remove("hidden");
        setTimeout(() => {
          emailSection.scrollIntoView({ behavior: "smooth", block: "start" });
        }, 180);
        emailPreviewEl.classList.add("hidden");
        emailPreviewEl.innerHTML = "";
        emailSendBtn.classList.add("hidden");
        emailSendStatusEl.classList.add("hidden");
        emailSendStatusEl.textContent = "";
        lastEmailDraft = null;
      });

      // ì´ë©”ì¼ ë¯¸ë¦¬ë³´ê¸° ë²„íŠ¼ í´ë¦­
      emailPreviewBtn.addEventListener("click", async () => {
        if (lastSelectedIndex < 0 || !lastCandidates[lastSelectedIndex]) {
          alert(t("alerts.needSelection"));
          return;
        }
        if (!lastDutyCalc) {
          alert(t("alerts.needDuty"));
          return;
        }

        const emailTo = (emailToInput.value || "").trim();
        if (!emailTo) {
          alert(t("alerts.emailRequired"));
          return;
        }
        // ì•„ì£¼ ê°„ë‹¨í•œ ì´ë©”ì¼ í˜•ì‹ ì²´í¬
        if (!/.+@.+\..+/.test(emailTo)) {
          alert(t("alerts.emailFormat"));
          return;
        }

        const productName = document.getElementById("product_name").value;
        const exporterHs = document.getElementById("exporter_hs").value || null;
        const description = document.getElementById("description").value;
        const countryOfOrigin = document.getElementById("country_of_origin").value;

        const selected = lastCandidates[lastSelectedIndex];

        const payload = {
          product_name: productName,
          exporter_hs: exporterHs,
          description: description,
          country_of_origin: countryOfOrigin,

          email_to: emailTo,
          query_prompt: lastQueryPrompt,

          hts_code: selected.hts_code || "",
          hts_title: selected.title || "",
          estimated_tariff_rate: selected.estimated_tariff_rate || selected.tariff || "",
          confidence: selected.confidence ?? null,

          qty: lastDutyCalc.qty,
          unit_price: lastDutyCalc.unitPrice,
          total_value_usd: lastDutyCalc.totalValueUsd,
          duty_usd: lastDutyCalc.dutyUsd,

          total_value_krw: lastDutyCalc.totalKrw,
          duty_krw: lastDutyCalc.dutyKrw,
          usd_krw_rate: lastDutyCalc.usdKrwRate,
        };

        emailPreviewEl.classList.remove("hidden");
        emailPreviewEl.innerHTML = t("email.previewLoading");
        emailSendBtn.classList.add("hidden");
        emailSendStatusEl.classList.add("hidden");
        emailSendStatusEl.textContent = "";
        lastEmailDraft = null;

        try {
          const res = await fetch("http://127.0.0.1:8000/api/preview_email", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(payload),
          });
          if (!res.ok) {
            const errorText = await res.text();
            emailPreviewEl.innerHTML =
              '<div class="error-box">Error: ' + (errorText || res.statusText) + "</div>";
            return;
          }
          const data = await res.json();

          if (data.error) {
            emailPreviewEl.innerHTML =
              '<div class="error-box">Error: ' + data.error + "</div>";
            return;
          }

          const to = data.to || emailTo;
          const subject = data.subject || "";
          const body = data.body || "";

          emailPreviewEl.innerHTML = `
          <div class="email-preview-header">${t("email.previewTitle")}</div>
          <div class="email-preview-meta">
            To: ${to}<br/>
            Subject: ${subject}
          </div>
          <div>${body.replace(/\n/g, "<br />")}</div>
        `;

          // ë§ˆì§€ë§‰ ì´ë©”ì¼ ì´ˆì•ˆ ì €ì¥ (ë°œì†¡ìš©)
          lastEmailDraft = { to, subject, body };
          emailSendBtn.classList.remove("hidden");
          emailSendStatusEl.classList.add("hidden");
          emailSendStatusEl.textContent = "";

          setTimeout(() => {
            emailPreviewEl.scrollIntoView({ behavior: "smooth", block: "start" });
          }, 120);
        } catch (err) {
          console.error(err);
          emailPreviewEl.innerHTML =
            '<div class="error-box">Error: ' + String(err) + "</div>";
        }
      });

      // ì´ë©”ì¼ ë°œì†¡ ë²„íŠ¼ í´ë¦­
      emailSendBtn.addEventListener("click", async () => {
        if (!lastEmailDraft) {
          alert(t("alerts.needPreview"));
          return;
        }

        const accessToken = emailAccessTokenInput.value.trim();
        if (accessToken) {
          localStorage.setItem("EMAIL_ACCESS_TOKEN", accessToken);
        }

        emailSendStatusEl.classList.remove("hidden");
        emailSendStatusEl.textContent = t("email.statusSending");

        try {
          const res = await fetch("http://127.0.0.1:8000/api/send_email", {
            method: "POST",
            headers: {
              "Content-Type": "application/json",
              ...(accessToken ? { "X-Access-Token": accessToken } : {}),
            },
            body: JSON.stringify({
              email_to: lastEmailDraft.to,
              subject: lastEmailDraft.subject,
              body: lastEmailDraft.body,
            }),
          });
          const data = await res.json();
          if (data.error) {
            emailSendStatusEl.textContent =
              t("email.statusError", { error: data.error });
          } else {
            emailSendStatusEl.textContent =
              t("email.statusSuccess");
          }
        } catch (err) {
          console.error(err);
          emailSendStatusEl.textContent =
            t("email.statusError", { error: String(err) });
        }
      });
    </script>
</body>

</html>